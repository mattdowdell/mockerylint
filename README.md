# mockerylint

[![CI](https://github.com/mattdowdell/mockerylint/actions/workflows/ci.yaml/badge.svg)](https://github.com/mattdowdell/mockerylint/actions/workflows/ci.yaml)
[![pkg.go.dev](https://pkg.go.dev/badge/github.com/mattdowdell/mockerylint.svg)](https://pkg.go.dev/github.com/mattdowdell/mockerylint)

Mockerylint is a Go linter for use with mocks generated by [mockery].

[mockery]: https://vektra.github.io/mockery/

## Install

At present, Mockerylint is undergoing initial development, with multiple features planned before the
creation of a stable release. Eventually, Mockerylint will be added to golangci-lint (see [#9]).
Until then, pre-built binaries for early releases can be downloaded from the [Releases] page.

[#9]: https://github.com/mattdowdell/mockerylint/issues/9
[Releases]: https://github.com/mattdowdell/mockerylint/releases

## Rules

### Testify

The following rules are applied to mocks based on [testify/mock]. Some of the rules are aimed at
encouraging use of features in Mockery, whilst others are to encourage more strict usage of the
underlying Testify library.

If there are additional rules you would like to see added, please open an issue.

[testify/mock]: https://pkg.go.dev/github.com/stretchr/testify/mock

#### noassert

_In progress ([#4](https://github.com/mattdowdell/mockerylint/issues/4))._

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)

  // add expectations here
  // use expectations here

  example.AssertExpectations()
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)

  // add expectations here
  // use expectations here
}
```

</td></tr>
</tbody></table>

#### usefactory

_In progress ([#5](https://github.com/mattdowdell/mockerylint/issues/5))._

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example1 := new(MockExample)
  example2 := &MockExample{}
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)
}
```

</td></tr>
</tbody></table>

#### useexpecter

In Mockery v2.10.0, with `with-expecter` option was added. Enabling this option causes a `.EXPECT()`
method to be generated for the mock, which returns an expecter. The expecter is a more type-safe
option for defining mocks. Where Testify's `.On()` accepts any number of arguments, the equivalent
expecter method accepts the same number as the mocked method. In both cases, the argument types can
be anything to enable use of [`mock.AnythingOfType`], [`mock.MatchedBy`], etc.

Since Mockery v3.0.0, the `with-expecter` option was removed and the expecter is always generated.

[`mock.AnythingOfType`]: https://pkg.go.dev/github.com/stretchr/testify/mock#AnythingOfType
[`mock.MatchedBy`]: https://pkg.go.dev/github.com/stretchr/testify/mock#MatchedBy

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)
  example.
    On("Do").
    Return(nil).
    Once()
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)
  example.
    EXPECT().
    Do().
    Return(nil).
    Once()
}
```

</td></tr>
</tbody></table>

#### usetimes

_In progress ([#6](https://github.com/mattdowdell/mockerylint/issues/6))._

_TODO: make allowing use of Maybe() configurable?_

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)
  example.EXPECT().Do().Return(nil)
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewMockExample(t)
  example.EXPECT().Do().Return(nil).Maybe()
  example.EXPECT().Do().Return(nil).Once()
  example.EXPECT().Do().Return(nil).Twice()
  example.EXPECT().Do().Return(nil).Times(3)
}
```

</td></tr>
</tbody></table>

## Matryer

Linting of mocks based on [matryer/moq] is not currently supported. If there are rules you would
like to see implemented, please open an issue.

[matryer/moq]: https://github.com/matryer/moq
