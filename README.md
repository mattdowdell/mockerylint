# mockerylint

Mockerylint is a Go linter for use with mocks generated by [mockery].

[mockery]: https://vektra.github.io/mockery/

## Rules

### Testify

The following rules are applied to mocks based on [testify/mock]. Some of the rules are aimed at
encouraging use of features in Mockery, whilst others are to encourage more strict usage of the
underlying Testify library.

[testify/mock]: https://pkg.go.dev/github.com/stretchr/testify/mock

#### noassert

_In progress ([#4](https://github.com/mattdowdell/mockerylint/issues/4))._

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)

  // add expectations here
  // use expectations here

  example.AssertExpectations()
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)

  // add expectations here
  // use expectations here
}
```

</td></tr>
</tbody></table>

#### usefactory

_In progress ([#5](https://github.com/mattdowdell/mockerylint/issues/5))._

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example1 := new(Example)
  example2 := &Example{}
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)
}
```

</td></tr>
</tbody></table>

#### useexpecter

In Mockery v2.10.0, with `with-expecter` option was added. Enabling this option causes a `.EXPECT()`
method to be generated for the mock, which returns an expecter. The expecter is a more type-safe
option for defining mocks. Where Testify's `.On()` accepts any number of arguments, the equivalent
expecter method accepts the same number as the mocked method. In both cases, the argument types can
be anything to enable use of [`mock.AnythingOfType`], [`mock.MatchedBy`], etc.

Since Mockery v3.0.0, the `with-expecter` option was removed and the expecter is always generated.

[`mock.AnythingOfType`]: https://pkg.go.dev/github.com/stretchr/testify/mock#AnythingOfType
[`mock.MatchedBy`]: https://pkg.go.dev/github.com/stretchr/testify/mock#MatchedBy

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)
  example.
    On("Do").
    Return(nil).
    Once()
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)
  example.
    EXPECT().
    Do().
    Return(nil).
    Once()
}
```

</td></tr>
</tbody></table>

#### usetimes

_In progress ([#6](https://github.com/mattdowdell/mockerylint/issues/6))._

_TODO: make allowing use of Maybe() configurable?_

<table>
<thead><tr><th>Bad</th><th>Good</th></tr></thead>
<tbody>
<tr><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)
  example.EXPECT().Do().Return(nil)
}
```

</td><td>

```go
func TestExample (t *testing.T) {
  example := NewExample(t)
  example.EXPECT().Do().Return(nil).Maybe()
  example.EXPECT().Do().Return(nil).Once()
  example.EXPECT().Do().Return(nil).Twice()
  example.EXPECT().Do().Return(nil).Times(3)
}
```

</td></tr>
</tbody></table>

## Matryer

Linting of mocks based on [matryer/moq] is not surrently supported.

[matryer/moq]: https://github.com/matryer/moq
